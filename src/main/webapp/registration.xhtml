<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="template.xhtml" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
		xmlns:card="http://www.bfh.ch/bookstore/taglib">
    <ui:define name="header">
        <ui:include src="header.xhtml">
            <ui:param name="pageTitle" value="#{texts.registerPageTitle}" />
        </ui:include>
    </ui:define>
    <ui:define name="content">
	<p/>
        <h:form id="registerForm">
            <h:panelGrid columns="2">
                <h:outputText value="#{texts.firstname}" />
		<h:panelGroup>
		    <h:inputText id="firstName" value="#{customerBean.customer.firstName}" size="30" required="true" />
		    <h:message for="firstName" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.lastname}" />
		<h:panelGroup>
		    <h:inputText id="lastname" value="#{customerBean.customer.lastName}" size="30" required="true" />
		    <h:message for="lastname" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.email}" />
		<h:panelGroup>
		    <h:inputText id="email" value="#{customerBean.customer.email}" size="30" required="true" />
		    <h:message for="email" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.password}" />
		<h:panelGroup>
		    <h:inputSecret id="password" value="#{customerBean.customer.password}" size="30" required="true" />
		    <h:message for="password" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
            </h:panelGrid>

	    <p/>
	    <h:outputText value="#{texts.address}" styleClass="subheading"/>
	    <h:panelGrid columns="2">
                <h:outputText value="#{texts.street}" />
		<h:panelGroup>
		    <h:inputText id="street" value="#{customerBean.customer.address.street}" size="30" required="true"/>
		    <h:message for="street" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.city}" />
		<h:panelGroup>
		    <h:inputText id="city" value="#{customerBean.customer.address.city}" size="30" required="true"/>
		    <h:message for="city" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.postalCode}" />
		<h:panelGroup>
		    <h:inputText id="postalCode" value="#{customerBean.customer.address.postalCode}" size="5" required="true"/>
		    <h:message for="postalCode" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.country}" />
		<h:panelGroup>
		    <h:selectOneMenu id="country" value="#{customerBean.country}" required="true">
			<f:selectItems value="#{applicationBean.countries}" var="country" 
				       itemLabel="#{country.name}" itemValue="#{country.code}" />
		    </h:selectOneMenu>
		    <h:message for="country" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
            </h:panelGrid>

	    <p/>
	    <h:outputText value="#{texts.creditCard}" styleClass="subheading"/>
	    <h:panelGrid columns="2">
                <h:outputText value="#{texts.cardType}" />
		<h:panelGroup>
		    <h:selectOneMenu id="cardType" value="#{customerBean.customer.creditCard.type}" required="true">
			<f:selectItems value="#{applicationBean.creditCardTypes}" var="type" 
				       itemLabel="#{type.name()}" itemValue="#{type.name()}" />
		    </h:selectOneMenu>
		    <h:message for="cardType" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.cardNumber}" />
		<h:panelGroup>
		    <h:inputText id="creditCardNumber" value="#{customerBean.customer.creditCard.number}" size="20">
			<card:validateCreditCardNumber cardTypeId="cardType" />
			<f:converter converterId="org.books.converter.CreditCardNumberConverter" />
		    </h:inputText>
		    <h:message for="creditCardNumber" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
                <h:outputText value="#{texts.cardValidTo}" />
		<h:panelGroup>
		    <h:inputText id="expirationMonth" value="#{customerBean.customer.creditCard.expirationMonth}" size="1" maxlength="2" required="true" />
		    /
		    <h:inputText id="expirationYear" value="#{customerBean.customer.creditCard.expirationYear}" size="1" maxlength="2" required="true" />
		    <h:message for="expirationMonth" errorClass="error" showSummary="true" showDetail="false" />
		    <h:message for="expirationYear" errorClass="error" showSummary="true" showDetail="false" />
		</h:panelGroup>
            </h:panelGrid>
	    <p/>
	    <h:messages showSummary="true" showDetail="false" errorClass="error" infoClass="info" layout="table" globalOnly="true" />
	    <p/>
	    <h:commandButton value="#{texts.register}" action="#{customerBean.register()}" />
	    <h:outputText value=" " />
	    <h:commandButton value="#{texts.cancel}" action="#{navigationBean.goBack()}" immediate="true" />
	    <p/>
            <h:commandLink value="#{texts.back}" action="#{navigationBean.goBack()}" immediate="true" />
        </h:form>
    </ui:define>
</ui:composition>
